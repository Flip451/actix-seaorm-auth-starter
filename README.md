# actix-seaorm-auth-starter

ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åŸå‰‡ã«åŸºã¥ãã€**Rust (Actix Web)** ã¨ **SeaORM** ã‚’ä½¿ç”¨ã—ã¦æ§‹ç¯‰ã•ã‚ŒãŸã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã™ã€‚
ï¼ˆã“ã® README ã¯ã€NotebookLM ã§ç”ŸæˆãŠã‚ˆã³ç·¨é›†ã•ã‚Œã¾ã—ãŸã€‚ï¼‰

## ğŸš€ ç‰¹å¾´

* **Clean Architecture**: ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼‰ã‚’ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„DBæŠ€è¡“ã‹ã‚‰åˆ†é›¢ã€‚
* **Secure Auth**: `Argon2` ã«ã‚ˆã‚‹å …ç‰¢ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ã¨ã€`JWT` (JSON Web Token) ã«ã‚ˆã‚‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹èªè¨¼ã€‚
* **Production Ready**: Dockerç’°å¢ƒã€OpenTelemetry (Jaeger) ã«ã‚ˆã‚‹åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ã€æ§‹é€ åŒ–ãƒ­ã‚°ã‚’å®Œå‚™ã€‚
* **Type Safe**: SeaORM ã«ã‚ˆã‚‹å‹å®‰å…¨ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã¨ã€Rustã®å‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨ã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã€‚
* **Developer Experience**: `Makefile` ã«ã‚ˆã‚‹é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®è‡ªå‹•åŒ–ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ç”Ÿæˆã€ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ï¼‰ã€‚

## ğŸ“… å®Ÿè£…çŠ¶æ³ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### å®Ÿè£…æ¸ˆã¿ (Current)

* [x] **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ² (`Signup`)**: é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆEmail/Usernameï¼‰ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
* [x] **ãƒ­ã‚°ã‚¤ãƒ³ (`Login`)**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼ã€JWTãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ
* [x] **ç®¡ç†è€…æ©Ÿèƒ½**: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¸€è¦§å–å¾— (`GET /admin/users`)
* [x] **ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å‚ç…§**: ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã®æƒ…å ±å–å¾— (`GET /users/me`)
* [x] **ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°**: ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å¤‰æ›´ (`PATCH /users/me`)

### ä»Šå¾Œã®å®Ÿè£…äºˆå®š (Roadmap)

* [ ] **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’è€ƒæ…®ã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ›´æ–°ãƒ•ãƒ­ãƒ¼
* [ ] **é€€ä¼šæ©Ÿèƒ½**: `is_active` ãƒ•ãƒ©ã‚°ã‚’ç”¨ã„ãŸè«–ç†å‰Šé™¤ã®å®Ÿè£…
* [ ] **ç®¡ç†è€…æ¨©é™**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®BANï¼ˆç„¡åŠ¹åŒ–ï¼‰ã‚„æ¨©é™æ˜‡æ ¼æ©Ÿèƒ½

---

## ğŸ— ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ§‹æˆ

ä¾å­˜é–¢ä¿‚ã®ãƒ«ãƒ¼ãƒ«ï¼ˆDependency Ruleï¼‰ã«å¾“ã„ã€å¤–å´ã‹ã‚‰å†…å´ã¸ã®ã¿ä¾å­˜ã™ã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | å½¹å‰² | ä¾å­˜å…ˆ |
| --- | --- | --- | --- |
| **Domain** | `src/domain` | ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ | ãªã— (æœ€å†…æ®») |
| **UseCase** | `src/usecase` | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆServiceï¼‰ | Domain |
| **Infrastructure** | `src/infrastructure` | æŠ€è¡“çš„è©³ç´°ï¼ˆDBå®Ÿè£…ã€JWTã€ãƒãƒƒã‚·ãƒ¥åŒ–ãªã©ï¼‰ | Domain, UseCase |
| **API (Interface)** | `src/api` | HTTPãƒãƒ³ãƒ‰ãƒ©ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¤‰æ› | Domain, UseCase |
| **Main** | `src/main.rs` | DIï¼ˆä¾å­˜æ€§ã®æ³¨å…¥ï¼‰ã€ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã€æ§‹æˆ | å…¨ã¦ |

---

## ğŸ›  ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨å®Ÿè¡Œ

### å‰ææ¡ä»¶

* Docker & Docker Compose
* Make

### 1. ç’°å¢ƒè¨­å®š

`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
cp .env.example .env
```

### 2. ãƒ“ãƒ«ãƒ‰ã¨èµ·å‹•

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ã‚¢ãƒ—ãƒªå®Ÿè¡Œç’°å¢ƒã¨DBæ“ä½œãƒ„ãƒ¼ãƒ«ï¼ˆSeaORM CLIï¼‰ã‚’åˆ†ã‘ã¦ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚

```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ„ãƒ¼ãƒ«ã®ãƒ“ãƒ«ãƒ‰
make build
make build-tools

# ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹• (App, DB, Jaeger)
make up

# DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®é©ç”¨ï¼ˆåˆå›èµ·å‹•æ™‚å¿…é ˆï¼‰
make migrate-up
```

èµ·å‹•å¾Œã€APIã‚µãƒ¼ãƒãƒ¼ã¯ `http://localhost:8080` ã§å¾…æ©Ÿã—ã¾ã™ã€‚

---

## ğŸ“¡ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

| æ©Ÿèƒ½ | ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èªè¨¼ | èª¬æ˜ |
| --- | --- | --- | --- | --- |
| **ç™»éŒ²** | `POST` | `/auth/signup` | ä¸è¦ | æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¾ã™ |
| **ãƒ­ã‚°ã‚¤ãƒ³** | `POST` | `/auth/login` | ä¸è¦ | JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã—ã¾ã™ |
| **è‡ªåˆ†ã®æƒ…å ±** | `GET` | `/users/me` | **å¿…é ˆ** | è‡ªèº«ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’å–å¾—ã—ã¾ã™ |
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§** | `GET` | `/admin/users` | **Admin** | å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¡¨ç¤ºã—ã¾ã™ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰ |

> **Note**: èªè¨¼ãŒå¿…è¦ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã¯ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã« `Authorization: Bearer <token>` ã‚’ä»˜ä¸ã—ã¦ãã ã•ã„ã€‚

---

## ğŸ’» é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ |
| --- | --- |
| `make watch` | ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰æœ‰åŠ¹ã§ã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œï¼ˆé–‹ç™ºç”¨ï¼‰ |
| `make test` | ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ |
| `make logs` | ã‚³ãƒ³ãƒ†ãƒŠãƒ­ã‚°ã®è¡¨ç¤º |
| `make shell` | ã‚¢ãƒ—ãƒªã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚·ã‚§ãƒ«ã‚’èµ·å‹• |
| `make db-shell` | DBã‚³ãƒ³ãƒ†ãƒŠã« `psql` ã§æ¥ç¶š |

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¤‰æ›´ãƒ•ãƒ­ãƒ¼

1. **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ**

    ```bash
    make migrate-generate name=add_profile_columns
    ```

2. **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®é©ç”¨**

    ```bash
    make migrate-up
    ```

3. **ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆRustã‚³ãƒ¼ãƒ‰ï¼‰ã®è‡ªå‹•ç”Ÿæˆ**
    DBã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰ `ActiveModel` ã‚’å†ç”Ÿæˆã—ã¾ã™ã€‚

    ```bash
    make generate-entity
    ```

---

## ğŸ“‚ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```text
.
â”œâ”€â”€ migration/              # SeaORM ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                # ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å±¤ (Handler, DTO)
â”‚   â”‚   â”œâ”€â”€ auth/           # èªè¨¼é–¢é€£ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ user/           # ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ domain/             # ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ (Entity, Repository Trait)
â”‚   â”œâ”€â”€ usecase/            # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ (Service)
â”‚   â”‚   â”œâ”€â”€ auth/           # ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â””â”€â”€ user/           # ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ infrastructure/     # ã‚¤ãƒ³ãƒ•ãƒ©å±¤ (DBå®Ÿè£…, Argno2, JWT)
â”‚   â”‚   â””â”€â”€ persistence/    # SeaORMã«ã‚ˆã‚‹ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…
â”‚   â””â”€â”€ main.rs             # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ (DIè¨­å®š)
â”œâ”€â”€ compose.yml             # Docker Compose è¨­å®š
â”œâ”€â”€ Dockerfile              # ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰å®šç¾©
â”œâ”€â”€ Makefile                # é–‹ç™ºç”¨ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼
â””â”€â”€ Cargo.toml              # ä¾å­˜é–¢ä¿‚å®šç¾©
```

## ğŸ“ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

* **Language**: Rust 1.x
* **Web Framework**: Actix Web
* **Database**: PostgreSQL 15
* **ORM**: SeaORM (Async & Dynamic)
* **Auth**: Argon2 (Password Hashing), jsonwebtoken (JWT)
* **Observability**: Tracing, OpenTelemetry, Jaeger
* **Error Handling**: thiserror, anyhow
* **Validation**: validator crate
